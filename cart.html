<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡</title>
<style>
  .cart-icon { position: fixed; top: 10px; right: 10px; }
  .cart-icon span { background: red; color: white; padding: 2px 6px; border-radius: 50%; }
  p { margin-bottom: 10px; }
  img { width: 50px; height: 50px; vertical-align: middle; margin-right: 5px; }
  button { margin: 0 2px; }
</style>
</head>
<body>

<h1>Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡</h1>

<select id="governorate">
  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
  <option value="cairo">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
  <option value="giza">Ø§Ù„Ø¬ÙŠØ²Ø©</option>
  <option value="alex">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
  <option value="other">Ø£Ø®Ø±Ù‰</option>
</select>

<div id="items"></div>

<p>Ø§Ù„Ø´Ø­Ù†: <span id="shipping">0</span> Ø¬Ù†ÙŠÙ‡</p>
<p>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="total">0</span> Ø¬Ù†ÙŠÙ‡</p>

<button onclick="goCheckout()">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>

<div class="cart-icon">
  ğŸ›’ <span id="cartCount">0</span>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];
let box = document.getElementById("items");
let subtotal = 0;
let shippingCost = 0;

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø­Ø³Ø¨ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ…ÙŠØ§Øª
function updateCartIcon(){
  const count = cart.reduce((sum,item)=>sum + (item.qty || 0),0);
  document.getElementById("cartCount").innerText = count;
}

function render() {
  const gov = document.getElementById("governorate").value;
  box.innerHTML = "";
  subtotal = 0;

  if(cart.length === 0) {
    box.innerHTML = "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©";
    shippingCost = 0;
  } else {
    cart.forEach((item, index) => {
      subtotal += item.price * item.qty;

      const p = document.createElement("p");
      p.innerHTML = `
        <img src="${item.img}" alt="${item.name}">
        ${item.name} - ${item.price} Ø¬Ù†ÙŠÙ‡
        <input type="text" class="qty" value="${item.qty}" readonly>
        <button class="decrease">-</button>
        <button class="increase">+</button>
        <button class="remove">âŒ</button>
      `;
      box.appendChild(p);

      // Ø§Ø³ØªØ®Ø¯Ø§Ù… closure Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
      p.querySelector(".increase").addEventListener("click", () => {
        item.qty++;
        localStorage.setItem("cart", JSON.stringify(cart));
        render();
      });

      p.querySelector(".decrease").addEventListener("click", () => {
        if(item.qty > 1) item.qty--;
        else cart = cart.filter(el => el !== item); // Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± Ù†ÙØ³Ù‡
        localStorage.setItem("cart", JSON.stringify(cart));
        render();
      });

      p.querySelector(".remove").addEventListener("click", () => {
        cart = cart.filter(el => el !== item);
        localStorage.setItem("cart", JSON.stringify(cart));
        render();
      });
    });
  }

  // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø´Ø­Ù†
  if(gov==='cairo') shippingCost=50;
  else if(gov==='giza') shippingCost=60;
  else if(gov==='alex') shippingCost=70;
  else if(gov==='other') shippingCost=80;
  else shippingCost=0;

  document.getElementById("shipping").innerText = shippingCost;
  document.getElementById("total").innerText = subtotal + shippingCost;

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
  updateCartIcon();
}


// Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ÙŠØ­Ø¯Ø« Ø§Ù„Ø´Ø­Ù† + Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹
document.getElementById("governorate").addEventListener("change", render);

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© checkout
function goCheckout(){
  const gov = document.getElementById("governorate").value;
  if(cart.length === 0){
    alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©");
    return;
  }
  if(!gov){
    alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }
  localStorage.setItem("selectedGovernorate", gov);
  window.location.href="checkout.html";
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ render Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
render();
</script>

</body>
</html>



