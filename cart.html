<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>سلة الشراء</title>
<style>
body { font-family: Arial; background:#f5f5f5; margin:0; padding:20px; direction: rtl; }
h1 { text-align:center; }
#items { margin-top:20px; }
.item { display:flex; justify-content:space-between; align-items:center; background:#fff; margin-bottom:10px; padding:10px; border-radius:5px; }
.item-left { display:flex; align-items:center; }
.item-left img { width:50px; height:50px; margin-left:10px; }
.qty-controls { display:flex; align-items:center; }
.qty-controls button { margin:0 5px; padding:5px 10px; cursor:pointer; }
.qty-controls input { width:30px; text-align:center; }
</style>
</head>
<body>

<h1>سلة الشراء</h1>
<select id="governorate">
  <option value="">اختر المحافظة</option>
  <option value="cairo">القاهرة</option>
  <option value="giza">الجيزة</option>
  <option value="alex">الإسكندرية</option>
  <option value="other">أخرى</option>
</select>

<div id="items"></div>
<p>الشحن: <span id="shipping">0</span> جنيه</p>
<p>المجموع النهائي: <span id="total">0</span> جنيه</p>
<button onclick="goCheckout()" style="width:100%; padding:15px; background:green; color:white; border:none; border-radius:5px; cursor:pointer;">إكمال الطلب</button>

<script>
let box = document.getElementById("items");

function render(){
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  let subtotal = 0;
  box.innerHTML = cart.length === 0 ? "<p>السلة فاضية</p>" : "";

  cart.forEach((item, i)=>{
    subtotal += item.price * item.qty;
    const p = document.createElement("div");
    p.classList.add("item");
    p.innerHTML = `
      <div class="item-left"><img src="${item.img}"><span>${item.name} - ${item.price} ج</span></div>
      <div class="qty-controls">
        <button onclick="changeQty(${i},-1)">-</button>
        <input type="text" value="${item.qty}" readonly>
        <button onclick="changeQty(${i},1)">+</button>
        <button onclick="removeItem(${i})">❌</button>
      </div>`;
    box.appendChild(p);
  });

  const gov = document.getElementById("governorate").value;
  let shippingCost = gov==='cairo'?50:gov==='giza'?60:gov==='alex'?70:gov==='other'?80:0;
  
  document.getElementById("shipping").innerText = shippingCost;
  const finalTotal = subtotal + shippingCost;
  document.getElementById("total").innerText = finalTotal;
  localStorage.setItem("tempTotal", finalTotal); // Save total for payment page
}

function changeQty(i, delta){
  const cart = JSON.parse(localStorage.getItem("cart"));
  cart[i].qty += delta;
  if(cart[i].qty < 1) return removeItem(i);
  localStorage.setItem("cart", JSON.stringify(cart));
  render();
}

function removeItem(i){
  const cart = JSON.parse(localStorage.getItem("cart"));
  cart.splice(i,1);
  localStorage.setItem("cart", JSON.stringify(cart));
  render();
}

document.getElementById("governorate").addEventListener("change", render);

function goCheckout(){
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  if(cart.length===0 || !document.getElementById("governorate").value) return alert("اكمل البيانات");
  localStorage.setItem("selectedGovernorate", document.getElementById("governorate").value);
  window.location.href="checkout.html";
}

window.addEventListener('pageshow', render);
render();
</script>
</body>
</html>

