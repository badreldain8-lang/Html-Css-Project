<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Cart</title>
<style>
body { font-family: Arial; background:#f5f5f5; margin:20px; }
img { width:80px; vertical-align:middle; margin-right:10px; }
button { padding:5px 10px; cursor:pointer; margin-left:5px; }
.qty { width:30px; text-align:center; }
.form-section { display:none; margin-top:20px; }
</style>
</head>
<body>

<h2>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h2>

<div id="items"></div>

<p>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ù„Ù„Ø´Ø­Ù†:</p>
<select id="governorate" onchange="updateShipping()">
  <option value="">-- Ø§Ø®ØªØ± --</option>
  <option value="cairo">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
  <option value="giza">Ø§Ù„Ø¬ÙŠØ²Ø©</option>
  <option value="alex">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
  <option value="other">Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
</select>

<p>Ø³Ø¹Ø± Ø§Ù„Ø´Ø­Ù†: <span id="shipping">0</span> Ø¬Ù†ÙŠÙ‡</p>
<p>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span> Ø¬Ù†ÙŠÙ‡</p>

<button id="checkoutBtn" onclick="showForm()">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>

<!-- form Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
<div class="form-section" id="customerForm">
  <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
  <label>Ø§Ù„Ø§Ø³Ù…:</label><br>
  <input type="text" id="customerName"><br>
  <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label><br>
  <input type="text" id="customerAddress"><br>
  <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label><br>
  <input type="text" id="customerPhone"><br>
  <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</label><br>
  <select id="customerGovernorate">
    <option value="">-- Ø§Ø®ØªØ± --</option>
    <option value="cairo">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
    <option value="giza">Ø§Ù„Ø¬ÙŠØ²Ø©</option>
    <option value="alex">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
    <option value="other">Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
  </select><br><br>
  <button onclick="confirmOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];
let box = document.getElementById("items");
let subtotal = 0;
let shippingCost = 0;

function render(){
  box.innerHTML = "";
  subtotal = 0;

  if(cart.length === 0){
    box.innerHTML = "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©";
  } else {
    cart.forEach((item,i)=>{
      subtotal += item.price * (item.qty || 1);
      box.innerHTML += `
        <p>
          <img src="${item.img}" alt="${item.name}">
          ${item.name} - ${item.price} Ø¬Ù†ÙŠÙ‡
          <button onclick="decreaseQty(${i})">-</button>
          <input type="text" class="qty" id="qty${i}" value="${item.qty}" readonly>
          <button onclick="increaseQty(${i})">+</button>
          <button onclick="removeItem(${i})">âŒ</button>
        </p>
      `;
    });
  }

  document.getElementById("total").innerText = subtotal + shippingCost;
  localStorage.setItem("cart", JSON.stringify(cart));
}

function removeItem(i){
  cart.splice(i,1);
  render();
}

function increaseQty(i){
  cart[i].qty++;
  render();
}

function decreaseQty(i){
  if(cart[i].qty>1) cart[i].qty--;
  else cart.splice(i,1);
  render();
}

function updateShipping(){
  const gov = document.getElementById("governorate").value;
  if(gov==='cairo') shippingCost=50;
  else if(gov==='giza') shippingCost=60;
  else if(gov==='alex') shippingCost=70;
  else if(gov==='other') shippingCost=80;
  else shippingCost=0;

  document.getElementById("shipping").innerText = shippingCost;
  document.getElementById("total").innerText = subtotal+shippingCost;
}

// Ø¥Ø¸Ù‡Ø§Ø± form Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
function showForm(){
  if(cart.length === 0){
    alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©");
    return;
  }
  document.getElementById("customerForm").style.display="block";
  document.getElementById("checkoutBtn").style.display="none";
  // Ø§Ù†Ø³Ø® Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ù…Ù† cart Ø¥Ù„Ù‰ form
  document.getElementById("customerGovernorate").value = document.getElementById("governorate").value;
}

// ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ â†’ Ø­ÙØ¸ LocalStorage + ØªØ­ÙˆÙŠÙ„ Ù„Ù„ØµÙØ­Ø© Payment
function confirmOrder(){
  const name = document.getElementById("customerName").value;
  const address = document.getElementById("customerAddress").value;
  const phone = document.getElementById("customerPhone").value;
  const gov = document.getElementById("customerGovernorate").value;

  if(!name || !address || !phone || !gov){
    alert("Ø§ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    return;
  }

  let orderNumber = Math.floor(Math.random()*1000000);
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  orders.push({
    orderNumber,
    cart,
    total: subtotal+shippingCost,
    customer:{name,address,phone,gov}
  });
  localStorage.setItem("orders", JSON.stringify(orders));

  // ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©
  cart = [];
  localStorage.setItem("cart", JSON.stringify(cart));

  window.location.href = "payment.html?order="+orderNumber;
}

render();
</script>

</body>
</html>


