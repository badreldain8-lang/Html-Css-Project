<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Local Brands Store</title>
    <style>
        body { font-family: Arial; background:#f5f5f5; margin:0; }
        header { background:#111; color:#fff; padding:15px; position:relative; }
        .cart-icon { position:absolute; top:15px; right:20px; cursor:pointer; }
        .cart-icon span { background:red; color:white; border-radius:50%; padding:2px 7px; font-size:12px; }
        .product { background:#fff; margin:15px; padding:15px; text-align:center; display:inline-block; width:200px; }
        .product img { width:100px; height:100px; display:block; margin:0 auto; background:#eee; }
        button { padding:8px 12px; cursor:pointer; margin-top:5px; }
    </style>
</head>
<body>

<header>
    <h2>Local Brands Store</h2>
    <div class="cart-icon" onclick="window.location.href='cart.html'">
        ðŸ›’ <span id="cartCount">0</span>
    </div>
</header>

<div class="product">
    <div style="width:100px;height:100px;background:#ddd;margin:0 auto;">IMG</div>
    <h3>T-Shirt</h3>
    <p>300 Ø¬Ù†ÙŠÙ‡</p>
    <button onclick="addToCart('T-Shirt', 300, '')">Add to cart</button>
</div>

<script>
    function updateCounter() {
        try {
            const data = localStorage.getItem("cart");
            const cart = data ? JSON.parse(data) : [];
            let total = 0;
            for(let i=0; i<cart.length; i++) {
                total += (Number(cart[i].qty) || 0);
            }
            document.getElementById("cartCount").innerText = total;
        } catch (e) {
            console.error("Storage corrupted, clearing...");
            localStorage.removeItem("cart"); // Fixes the white page by clearing bad data
        }
    }

    function addToCart(name, price, img) {
        let cart = [];
        try {
            cart = JSON.parse(localStorage.getItem("cart")) || [];
        } catch(e) { cart = []; }

        const found = cart.find(item => item.name === name);
        if(found) {
            found.qty++;
        } else {
            cart.push({name: name, price: price, img: img, qty: 1});
        }
        localStorage.setItem("cart", JSON.stringify(cart));
        updateCounter();
    }

    // Force update when coming back to the page
    window.addEventListener('pageshow', updateCounter);
    // Force update when tab is switched back
    document.addEventListener('visibilitychange', updateCounter);
    
    updateCounter();
</script>
</body>
</html>
