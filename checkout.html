<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Checkout</title>
</head>
<body>

<h2>إتمام الطلب</h2>

<label>اختر المحافظة:</label>
<select id="governorate" onchange="updateShipping()">
  <option value="">-- اختر --</option>
  <option value="cairo">القاهرة</option>
  <option value="giza">الجيزة</option>
  <option value="alex">الإسكندرية</option>
  <option value="other">باقي المحافظات</option>
</select>

<p>سعر الشحن: <span id="shipping">0</span> جنيه</p>
<p>الإجمالي: <span id="total">0</span> جنيه</p>

<button onclick="goPayment()">تأكيد الطلب</button>
<br><br>
<button onclick="openWhatsApp()">إرسال على واتساب</button>

<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];
let subtotal = cart.reduce((sum,item)=>sum+item.price,0);
let shippingCost = 0;

function updateShipping(){
  const gov = document.getElementById("governorate").value;
  if(gov==='cairo') shippingCost=50;
  else if(gov==='giza') shippingCost=60;
  else if(gov==='alex') shippingCost=70;
  else if(gov==='other') shippingCost=80;
  else shippingCost=0;

  document.getElementById("shipping").innerText = shippingCost;
  document.getElementById("total").innerText = subtotal+shippingCost;
}

// Initialize total
updateShipping();

// توليد رقم أوردر تلقائي
let orderNumber = Math.floor(Math.random()*1000000);

function goPayment(){
  // حفظ الأوردر في LocalStorage
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  orders.push({orderNumber, cart, total: subtotal+shippingCost});
  localStorage.setItem("orders", JSON.stringify(orders));

  window.location.href="payment.html?order="+orderNumber;
}

function openWhatsApp(){
  let phone = "201015653338"; // رقمك
  let msg = encodeURIComponent(
    "تم التحويل، ودي سكرين التحويل + الرقم اللي تم التحويل منه"
  );
  window.location.href = `https://wa.me/${phone}?text=${msg}`;
}
</script>

</body>
</html>

